\clearpage
\subsubsection{BPR}

\textbf{Configuration} \hfill Model name: Intel\textsuperscript{\textregistered} Xeon\textsuperscript{\textregistered} CPU E5-2640 v4 @ 2.40GHz
% IMPORT-DATA stats2 ../results.txt

\begin{figure}[ht]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                name=axis1,
                cycle list name={exoticlines},
                width=0.5\textwidth,
                height=48mm,
                title={wiki.txt},
                xlabel={input size [GiB]},
                ylabel={SA construction time [min]},
                legend columns=2,
                legend to name=legend-seq-bpr-0,
                legend style={
                    /tikz/every even column/.append style={column sep=0.5cm,black},
                    /tikz/every even column/.append style={black},
                },
            ]

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, time/1000/60 AS y, MULTIPLOT
            %% FROM (
            %% SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck FROM stats2 GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="wiki.txt" AND sacheck="ok" 
            %% AND (algo="BPR" OR algo="BPR_ref")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,0.532494) (0.390625,1.13966) (0.78125,2.44832) (1.5625,5.26654) (2.34375,10.7542) (3.125,15.4272) };
            \addlegendentry{algo=BPR};
            \addplot coordinates { (0.195312,0.711019) (0.390625,1.50131) (0.78125,2.75402) (1.5625,6.33265) };
            \addlegendentry{algo=BPR\_ref};

        \end{axis}
        \begin{axis}[
                cycle list name={exoticlines},
                at={(axis1.outer north east)},
                anchor=outer north west,
                name=axis2,
                width=0.5\textwidth,
                height=48mm,
                title={wiki.txt},
                xlabel={input size [GiB]},
                ylabel={Total Memory [GiB]},
            ]

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, memPeak/1024/1024/1024.0 AS y, MULTIPLOT
            %% FROM (
            %%      SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak+9*thread_count*200*1024*1024) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck
            %%      FROM stats2 WHERE thread_count < 9
            %%      GROUP BY algo, input, prefix, rep, thread_count
            %%      UNION
            %%      SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak+9*thread_count*200*1024*1024) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck
            %%      FROM stats2 WHERE thread_count > 9
            %%      GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="wiki.txt" AND sacheck="ok" 
            %% AND (algo="BPR")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,2.60708) (0.390625,5.14614) (0.78125,10.2252) (1.5625,20.3815) (2.34375,39.9817) (3.125,53.263) };
            \addlegendentry{algo=BPR};

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, memPeak/1024/1024/1024.0 AS y, MULTIPLOT
            %% FROM (
            %% SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck FROM stats2 GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="wiki.txt" AND sacheck="ok" 
            %% AND (algo="BPR_ref")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,3.38736) (0.390625,6.70768) (0.78125,13.3493) (1.5625,26.6305) };
            \addlegendentry{algo=BPR\_ref};

            \legend{}
        \end{axis}
    \end{tikzpicture}

    \medskip
    \ref{legend-seq-bpr-0}
    \caption{BPR und BPR\_ref auf wiki.txt}
    \label{fig-seq-bpr-0}
\end{figure}

\begin{figure}[ht]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                name=axis1,
                cycle list name={exoticlines},
                width=0.5\textwidth,
                height=48mm,
                title={dna.txt},
                xlabel={input size [GiB]},
                ylabel={SA construction time [min]},
                legend columns=2,
                legend to name=legend-seq-bpr-1,
                legend style={
                    /tikz/every even column/.append style={column sep=0.5cm,black},
                    /tikz/every even column/.append style={black},
                },
            ]

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, time/1000/60 AS y, MULTIPLOT
            %% FROM (
            %% SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck FROM stats2 GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="dna.txt" AND sacheck="ok" 
            %% AND (algo="BPR" OR algo="BPR_ref")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,0.565245) (0.390625,1.2152) (0.78125,2.53825) (1.5625,6.4462) (2.34375,10.0274) (3.125,14.4375) };
            \addlegendentry{algo=BPR};
            \addplot coordinates { (0.195312,0.617205) (0.390625,1.37002) (0.78125,2.99629) (1.5625,7.45044) };
            \addlegendentry{algo=BPR\_ref};

        \end{axis}
        \begin{axis}[
                cycle list name={exoticlines},
                at={(axis1.outer north east)},
                anchor=outer north west,
                name=axis2,
                width=0.5\textwidth,
                height=48mm,
                title={dna.txt},
                xlabel={input size [GiB]},
                ylabel={Total Memory [GiB]},
            ]

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, memPeak/1024/1024/1024.0 AS y, MULTIPLOT
            %% FROM (
            %%      SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak+9*thread_count*200*1024*1024) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck
            %%      FROM stats2 WHERE thread_count < 9
            %%      GROUP BY algo, input, prefix, rep, thread_count
            %%      UNION
            %%      SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak+9*thread_count*200*1024*1024) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck
            %%      FROM stats2 WHERE thread_count > 9
            %%      GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="dna.txt" AND sacheck="ok" 
            %% AND (algo="BPR")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,2.54135) (0.390625,5.08041) (0.78125,10.1585) (1.5625,20.3148) (2.34375,39.8463) (3.125,53.1276) };
            \addlegendentry{algo=BPR};

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, memPeak/1024/1024/1024.0 AS y, MULTIPLOT
            %% FROM (
            %% SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck FROM stats2 GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="dna.txt" AND sacheck="ok" 
            %% AND (algo="BPR_ref")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,3.32044) (0.390625,6.64075) (0.78125,13.2814) (1.5625,26.5626) };
            \addlegendentry{algo=BPR\_ref};

            \legend{}
        \end{axis}
    \end{tikzpicture}

    \medskip
    \ref{legend-seq-bpr-1}
    \caption{BPR und BPR\_ref auf dna.txt}
    \label{fig-seq-bpr-1}
\end{figure}

\begin{figure}[ht]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                name=axis1,
                cycle list name={exoticlines},
                width=0.5\textwidth,
                height=48mm,
                title={commoncrawl.txt},
                xlabel={input size [GiB]},
                ylabel={SA construction time [min]},
                legend columns=2,
                legend to name=legend-seq-bpr-2,
                legend style={
                    /tikz/every even column/.append style={column sep=0.5cm,black},
                    /tikz/every even column/.append style={black},
                },
            ]

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, time/1000/60 AS y, MULTIPLOT
            %% FROM (
            %% SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck FROM stats2 GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="commoncrawl.txt" AND sacheck="ok" 
            %% AND (algo="BPR" OR algo="BPR_ref")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,0.459639) (0.390625,0.999954) (0.78125,2.14934) (1.5625,4.66061) (2.34375,9.59213) (3.125,13.9262) };
            \addlegendentry{algo=BPR};
            \addplot coordinates { (0.195312,0.614869) (0.390625,1.06332) (0.78125,2.889) (1.5625,5.03779) };
            \addlegendentry{algo=BPR\_ref};

        \end{axis}
        \begin{axis}[
                cycle list name={exoticlines},
                at={(axis1.outer north east)},
                anchor=outer north west,
                name=axis2,
                width=0.5\textwidth,
                height=48mm,
                title={commoncrawl.txt},
                xlabel={input size [GiB]},
                ylabel={Total Memory [GiB]},
            ]

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, memPeak/1024/1024/1024.0 AS y, MULTIPLOT
            %% FROM (
            %%      SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak+9*thread_count*200*1024*1024) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck
            %%      FROM stats2 WHERE thread_count < 9
            %%      GROUP BY algo, input, prefix, rep, thread_count
            %%      UNION
            %%      SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak+9*thread_count*200*1024*1024) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck
            %%      FROM stats2 WHERE thread_count > 9
            %%      GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="commoncrawl.txt" AND sacheck="ok" 
            %% AND (algo="BPR")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,2.63699) (0.390625,5.18241) (0.78125,10.2632) (1.5625,20.4194) (2.34375,40.0576) (3.125,53.3388) };
            \addlegendentry{algo=BPR};

            %% MULTIPLOT(algo) SELECT prefix/1024/1024/1024.0 AS x, memPeak/1024/1024/1024.0 AS y, MULTIPLOT
            %% FROM (
            %% SELECT algo, input, MEDIAN(memFinal) AS memFinal, MEDIAN(memOff) AS memOff, AVG(memPeak) AS memPeak, prefix, rep, thread_count, MEDIAN(time) AS time, sacheck FROM stats2 GROUP BY algo, input, prefix, rep, thread_count
            %% ) WHERE input="commoncrawl.txt" AND sacheck="ok" 
            %% AND (algo="BPR_ref")
            %% GROUP BY MULTIPLOT,x ORDER BY MULTIPLOT,x
            \addplot coordinates { (0.195312,3.41701) (0.390625,6.74363) (0.78125,13.3868) (1.5625,26.6681) };
            \addlegendentry{algo=BPR\_ref};

            \legend{}
        \end{axis}
    \end{tikzpicture}

    \medskip
    \ref{legend-seq-bpr-2}
    \caption{BPR und BPR\_ref auf commoncrawl.txt}
    \label{fig-seq-bpr-2}
\end{figure}
\FloatBarrier

Für die Auswertung der Implementierung von \bpr wurde die von uns implementierte Version der Referenzimplementierung auf verschiedenen Dateien gegenübergestellt.
An den oben stehenden Diagrammen (\cref{fig-seq-bpr-0,fig-seq-bpr-2,fig-seq-bpr-2}) ist sofort erkennbar, dass die Beschränkung der Ressourcen im Bezug auf Hauptspeicher eine große Rolle bei der Messung gespielt hat:
Die auf dem Rechenknoten verfügbaren 64\,GB Hauptspeicher erlauben auf allen getesteten Eingabedateien im Falle der Referenzimplementierung eine maximale Größe von 1.6\,GB und im Falle der eigenen Implementierung maximal 3.2\,GB.
Die größte getestete Eingabe mit einer Dateigröße von 4\,GB konnte durch die Beschränkung der Ressourcen und den hohen Bedarf an Hauptspeicher von keinem der beiden vorliegenden Algorithmen verarbeitet werden.
Aus Gründen der Unterscheidbarkeit von BPR und BPR\_ref wurden in den Diagrammen die Messpunkte des naiven Algorithmus zum Vergleich ausgelassen.
Die entsprechenden Werte sind den \cref{messung:tab:duration-large-seq-weak,messung:tab:mem-large-seq-weak} zu entnehmen.\par
Der Vergleich beider Algorithmen zeigt die aus der Theorie herleitbare und daher zu erwartende Struktur:
Während der Speicherbedarf beider Algorithmen nahezu unabhängig von der Art der Eingabedatei ist, liegt der Bedarf der eigenen Implementierung für Dateien kleiner als 2\,GB etwas unter der der Referenzimplementierung, da letztere für jede Eingabegröße 64\,Bit Indizes für das Suffix-Array verwendet und somit auch für kleinere Eingaben große Suffix-Arrays verwendet.
Zu beachten ist, dass an dieser Stelle im Gegensatz zu allen anderen Plots der Gesamtspeicherbedarf statt des Zusatzspeichers zum Vergleich herangezogen wurde.
Der Grund dafür ist der Quellcode der Referenzimplementierung, welcher sich nicht in ausreichender Tiefe in unser Framework integrieren lässt, um die Allokation verschiedener Speicherstrukturen nähergehend zu unterscheiden.\par
Auch bezüglich der Laufzeit ist erkennbar, dass die Optimierungen erfolgreich waren, wenngleich die Laufzeitersparnis je nach Eingabe nur 7.5\% bis 16.7\% beträgt.
